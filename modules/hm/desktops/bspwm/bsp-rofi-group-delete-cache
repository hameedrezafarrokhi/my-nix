#!/bin/bash
file="$HOME/.cache/bsp-delete"
[ ! -f "$file" ] && exit 0

# Build rofi menu
menu=""
while read id; do
    name=$(xprop -id "$id" WM_NAME 2>/dev/null | cut -d'"' -f2)
    class=$(xprop -id "$id" WM_CLASS 2>/dev/null | grep -o '"[^"]*"' | tail -1 | tr -d '"')
    [ -n "$name" ] && menu+="$id $name\0icon\x1f$class\n"
done < "$file"

[ -z "$menu" ] && exit 0

# Show rofi and get selection
selected=$(echo -e "$menu" | rofi -dmenu -i -p "Remove window:" -show-icons -theme $HOME/.config/rofi/themes/power.rasi)

# Extract id (first word before space) and remove that specific window
[ -n "$selected" ] && {
    selected_id=$(echo "$selected" | cut -d' ' -f1)
    grep -v "^$selected_id$" "$file" > "${file}.tmp"
    mv "${file}.tmp" "$file"
}
